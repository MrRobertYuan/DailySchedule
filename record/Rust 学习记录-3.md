# Day4

## 字符串

### 字符串切片

字符串切片的类型是 `&str`

```
fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s);

    s.clear(); // error!

    println!("the first word is: {}", word);
}
fn first_word(s: &String) -> &str {
    &s[..1]
}
```

这里错的原因是因为 s.clear() 需要一个可变借用，而word是 s 的一个不变借用，不能同时出现两种借用，所以这里出错。

之前的字符串字面量是切片类型 `&str`



不仅对字符串有切片，对于数组也可以有切片：

```
let a = [1, 2, 3, 4, 5];
let slice = &a[1..3];
assert_eq!(slice, &[2, 3]);
```

上面的切片类型为 `&[i32]`



### 字符串类型

RUST 中的字符是 4 个字节的 Unicode，但是字符串是 UTF-8 编码，每个字符可以占据 [1, 4] 个字节，这样有利于节省空间。

RUST 在语言级别，只有一种字符串类型 `str`，但是在标准库中还有多种字符串类型，使用最广的就是 `String`

`String` 是可增长，可改变且具有所有权的 UTF-8 编码字符串。



### String 和 &str 的转换

```
String::from("");
"".to_string();

&s
&s[..]
s.as_str()
```



### 字符串索引

RUST 不支持下标形式的字符串类型。

因为 Rust 中的字符长度不固定。

但是它又是支持切片的，不过使用切片处理Unicode的时候一定要非常小心。



### 字符串操作

#### 增加

```
push('');
push_str("");
```

#### 插入

但是这里还是有索引的使用，也是和切片一样，要注意不要卡在Unicode的中间。

```
insert(i, '');
insert_str(i, "");
```

上面的增加和插入都是语句，是没有返回值的，都是对一个可变字符串直接进行的操作。

#### 替换

```
replace("原本的串", "更改后的串");		# 替换所有后返回表达式，不更改原串
replacen("原本的串", "更改后的串", n);	# 替换前n个匹配的串，不更改原串
replace_range(替换的范围，"更改后的字符串") # 直接更改原串
```

#### 删除

```
pop() 删除并返回最后一个字符，如果没有字符了，就返回 None，注意这个弹出是可以检测Unicode的，是会按Unicode的长度弹出
remove(n) 删除这个字符串从n位置开始的一个Unicode字符，如果位置不对（不是一个字符的开头）会报错，，返回值为删除位置的字符
truncate(n) 删除这个字符从n位置开始一直到结尾的所有字符，直接操作，无返回值
clear() 删除字符串中的所有字符，相当于truncate(0)
```

#### 连接

```
+ 和 += 都可以
也可以用 add(self, s:&str) -> String
```

注意 右边必须是一个 `&str`类型，返回都是一个新的字符串，所以不要求原本是 mut 类型

注意，连加的时候，后面的所有加数应该都是 `&str` 类型。

注意：第一个加数是 String 类型的，它传入了自己，用完加号之后会被释放。

```
format!("{}{}",s1,s2);
```

也可以用格式化的方法来连接字符串。

这种方法不会让 s1 的所有权消失。



### 字符串转义

传统的都是一致的，用 '\\' 就可以

'r' 可以保持不使用转义

如果想在字符串中使用双引号，可以#" ..."..."... "# 

如果包含 "..."#..." 那么加一个就是不够的，就可以加两个 ##"..."#..."##，如果有 "## 就可以加三个，上不封顶。



### UTF-8 处理方法

#### 如果想用 Unicode 的方法遍历

```
for c in "中国人".chars(){
	
}
```

#### 如果想用字节

```
for b in "中国人".bytes(){

}
```



### 字符串剖析

#### &str

这个是不会变，是可以硬编码在可执行文件中的，运行速度很快

#### String

是在堆上分配的，创建的时候向内存申请空间，释放的时候归还空间

RUST 变量离开作用域时自动释放内存。



